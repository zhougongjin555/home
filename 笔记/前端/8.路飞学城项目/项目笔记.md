# 学城项目简记

- 跨域问题

  ```
  跨域是因为浏览器的同源策略导致的，也就是说浏览器会阻止非同源的请求~
  那什么是非同源呢~即域名不同，端口不同都属于非同源的~
  不同源的数据会被浏览器拦截，无法返回到后端，导致无法处理
  浏览器只阻止表单以及ajax请求，并不会阻止src请求，所以我们的cnd，图片等src请求都可以发~~
  
  解决办法1：
  	JSONP方法:使用script标签中的src属性，会发送get请求，并且不会被浏览器进行拦截
  解决办法2：	
  	添加响应头:通过自定义一个django中间件定义参数实现浏览器不拦截
  	
  ```

  ```python
  from django.utils.deprecation import MiddlewareMixin
  # q
  
  class MyCors(MiddlewareMixin):
      def process_response(self, request, response):
          response["Access-Control-Allow-Origin"] = "*"
          if request.method == "OPTIONS":
              response["Access-Control-Allow-Headers"] = "Content-Type"
              response["Access-Control-Allow-Methods"] = "DELETE, PUT, POST"
          return response
  ```

  

- Django ContentType组件

  ```
  1，from django.contrib.contenttypes.models import ContentType
  	此方法用来自动创建一个表与id的对应关系表
  2，from django.contrib.contenttypes.fields import GenericForeignKey
  	此方法用来实现对外键的约束，防止出现与外键对应表的主键不一致，例如，两个家庭，小区表外键连接了两个表，但是未连接成员，导致记录中出现非家庭成员
  3，from django.contrib.contenttypes.fields import GenericRelation
  	此方法用来反向查询，方便从被约束表-->有主键约束表的查询
  ```
  
  - urls.py
  
    ![image-20211122194543767](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211122194543767.png)
  
  - views.py
  
    ![image-20211122194841079](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211122194841079.png)
  
  - models.py
  
    ![image-20211122194709511](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211122194709511.png)

- 开发流程大纲

  - 1， 课程app

    ```
    category course coursedetail teacher   
    课程分类  课程	课程详情    教师     四张表
    
    接口
    分别返回四张表的数据，主要内容在于自定义序列化的方式不同，把存在于不同表中的数据整合序列化返回
    
    三大块，models, ~~urls~~ ,views,以及drf的serializers
    对映数据库--视图函数--序列化方法
    ```

    - models

       ![image-20211123174847233](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211123174847233.png)

    - views

       ![image-20211123175057870](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211123175057870.png)

    - serializers

       ![image-20211123175430901](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211123175430901.png)

  - 认证系统
  
    - 注册函数
  
      ![image-20211124170622671](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211124170622671.png)
  
    - 登陆函数
  
      ​	![image-20211124170842454](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211124170842454.png)
  
    - drf认证类
  
      ![image-20211124171015196](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211124171015196.png)
  
  - 商城（购物车）app
  
    ```python
    import redis
    
    POOL = redis.ConnectionPool(host="127.0.0.1", port=6379, decode_responses=True)
    rp = redis.Redis(connection_pool=POOL)
    
    ## 哈希存储
    # 设置键值对
    rp.hset('info', 'name', 'zhougongjin')
    rp.hget('info', 'name')
    rp.hgetall('info')
    
    # 批量设置
    rp.hmset('infos', {'name': 'zhouzhou', 'age': 100, "sex": 'male'})
    rp.hmget('infos', ['name', 'sex'])
    rp.hgetall('infos')
    ```
  
    
  
    - 通过一个类实现数据上传，查找，更新，删除
  
      ![image-20211124171458088](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211124171458088.png)
  
  - 结算支付中心
  
    - 结算中心
  
      ![image-20211124172254908](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211124172254908.png)
  
    - 支付中心
  
      ![image-20211124172400270](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211124172400270.png)